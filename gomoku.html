---
layout: default
title: Gomoku
hidden: true
---

<header class="intro-header" style="background-image: url('{{ site.baseurl }}/{% if page.header-img %}{{ page.header-img }}{% else %}{{ site.header-img }}{% endif %}')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="site-heading" id="tag-heading">
                    <h2>snz's Gomoku AI</h2>
                    <span class="subheading">{{ page.description }}</span>
                </div>
            </div>
        </div>
    </div>
</header>

<style>
#cmd{
	border:0;
	outline:0;
	background:transparent;
	border-bottom:1px solid black;
}
#mainDiv{
	width:min(800px,100%);
	margin:auto;
}
#lpart{
	float:left;
	width:60%;
	height:calc(800px*0.6);
}
#rpart{
	float:right;
	padding-left:5%;
	width:40%;
}
</style>

<script>
let worker,is_busy;
let len=19;
let skin=new Image();
let skin_load=new Promise(res=>{
	skin.onload=res;
	skin.src="/img/gomoku/HGarden2.png";
});

async function init_worker(){
	worker=new Worker("/js/gomoku/worker.js");
	is_busy=true;
	let p=new Promise(res=>{
		worker.onmessage=e=>{is_busy=false;res();};
	});
	await p;
}

async function submit(){
	let s=$("#cmd").val();
	if(s==="END"){
		worker.terminate();
		await init_worker();
		$("#cmd").val("");
		return;
	}
	if(is_busy)return;
	is_busy=true;
	worker.postMessage(s);
	$("#cmd").val("");
}
$(()=>{$("#cmd")[0].onkeydown=e=>{
	if(e.which==13)submit();
}});

async function Init(){
	await init_worker();
	let c_elem=$("#cvs");
	let ctx=c_elem[0].getContext("2d");
	let {width,height}=c_elem[0].getBoundingClientRect();
	
	await skin_load;
	let step=480/len;
	for(let i=0;i<len;i++)
		for(let j=0;j<len;j++){
			ctx.drawImage(skin,32*Math.floor(3*Math.random()),0,32,32,i*step,j*step,step,step);
		}
}
document.body.onload=Init;
</script>

<div id="mainDiv">
<div id="lpart">
<canvas style="width:100%;height:100%" width="480" height="480" id="cvs"></canvas>
</div>
<div id="rpart">
<label>Debug&gt; </label>
<input type="text" id="cmd" />
</div>
<div style="display:block"></div>
</div>
